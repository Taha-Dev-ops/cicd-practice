name: Taha's CI/CD Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    name: ğŸ§ª Run Automated Tests
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v3
    
    - name: ğŸ” Run Security Scan
      run: |
        echo "Checking for sensitive data..."
        if grep -r "password\|secret\|key" . --exclude-dir=.git; then
          echo "âŒ SECURITY ALERT: Sensitive data found!"
          exit 1
        else
          echo "âœ… PASS: No sensitive data found"
        fi
    
    - name: ğŸ§ª Run Application Tests
      run: |
        chmod +x test.sh
        ./test.sh
    
    - name: ğŸ“Š Test Report
      run: |
        echo "=== TEST SUMMARY ==="
        echo "âœ… All tests completed"
        echo "ğŸ“ Files tested: index.html, test.sh"
        echo "ğŸ‘¨â€ğŸ’» Tested by: GitHub Actions"
        echo "ğŸ¯ Pipeline: Taha DevOps CI/CD"

  deploy:
    name: ğŸš€ Deploy to Production
    runs-on: ubuntu-latest
    needs: test
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v3
      
    - name: ğŸ› ï¸ Build Application
      run: |
        echo "Building application..."
        echo "Application: Taha's CI/CD App"
        echo "Version: 1.0.0"
        echo "âœ… Build completed: $(date)"
        
    - name: ğŸš€ Deploy to Production
      run: |
        echo "=== DEPLOYMENT STARTED ==="
        echo "ğŸ•’ Time: $(date)"
        echo "ğŸ‘¤ Deployed by: ${{ github.actor }}"
        echo "ğŸ“ Commit: ${{ github.sha }}"
        echo "ğŸŒ Environment: PRODUCTION"
        echo "ğŸ¯ DevOps Engineer: Taha"
        echo "âœ… DEPLOYMENT SUCCESSFUL!"
        echo "ğŸ”— Application: https://taha-devops-app.com"
        echo "ğŸ“ˆ Status: HEALTHY"
        echo "ğŸ“Š Monitoring: ENABLED"
