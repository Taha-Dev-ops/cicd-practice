name: Taha's CI/CD Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    name: 🧪 Run Automated Tests
    runs-on: ubuntu-latest
    
    steps:
    - name: 📥 Checkout Code
      uses: actions/checkout@v3
    
    - name: 🔍 Run Security Scan
      run: |
        echo "Checking for sensitive data..."
        if grep -r "password\|secret\|key" . --exclude-dir=.git; then
          echo "❌ SECURITY ALERT: Sensitive data found!"
          exit 1
        else
          echo "✅ PASS: No sensitive data found"
        fi
    
    - name: 🧪 Run Application Tests
      run: |
        chmod +x test.sh
        ./test.sh
    
    - name: 📊 Test Report
      run: |
        echo "=== TEST SUMMARY ==="
        echo "✅ All tests completed"
        echo "📁 Files tested: index.html, test.sh"
        echo "👨‍💻 Tested by: GitHub Actions"
        echo "🎯 Pipeline: Taha DevOps CI/CD"

  deploy:
    name: 🚀 Deploy to Production
    runs-on: ubuntu-latest
    needs: test
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: 📥 Checkout Code
      uses: actions/checkout@v3
      
    - name: 🛠️ Build Application
      run: |
        echo "Building application..."
        echo "Application: Taha's CI/CD App"
        echo "Version: 1.0.0"
        echo "✅ Build completed: $(date)"
        
    - name: 🚀 Deploy to Production
      run: |
        echo "=== DEPLOYMENT STARTED ==="
        echo "🕒 Time: $(date)"
        echo "👤 Deployed by: ${{ github.actor }}"
        echo "📝 Commit: ${{ github.sha }}"
        echo "🌐 Environment: PRODUCTION"
        echo "🎯 DevOps Engineer: Taha"
        echo "✅ DEPLOYMENT SUCCESSFUL!"
        echo "🔗 Application: https://taha-devops-app.com"
        echo "📈 Status: HEALTHY"
        echo "📊 Monitoring: ENABLED"
